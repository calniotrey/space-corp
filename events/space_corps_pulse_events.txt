namespace = space_corps_pulse
# yearly pulse
# check if spawn corp is needed
# check connection to other corps
country_event = {
	id = space_corps_pulse.10
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		can_have_space_corp = yes
	}
	immediate = {
		change_variable = {
			which = years_until_next_corp_creation
			value = -1
		}
		country_event = {
			id = space_corps_pulse.11
			days = 5
			random = 350
		}
	}
}

# called from space_corps_pulse.11
# spawn a corp
# check connection to other corps
country_event = {
	id = space_corps_pulse.11
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		count_space_corps = yes
		if = {
			limit = {
				should_create_space_corp = yes
			}
			create_space_corp = yes
			last_created_country = {
				save_event_target_as = last_created_corp
				get_headquarters = yes
			}
			change_variable = {
				which = number_of_corps
				value = 1
			}
			randomize_space_corps_spawn_delay = yes
			if = {
				limit = { NOT = { has_country_flag = hide_space_corps_creation }}
				random_list = {
					# different images TODO
					1 = { country_event = { id = space_corps_pulse.18 }}
				}
			}
		}
		every_subject = {
			limit = {
				is_country_type = space_corp
			}
			get_headquarters = yes
			# performance intensive?
			# gives connected path to the **other** corp
			every_country = {
				limit = {
					is_country_type = space_corp
					NOT = {
						is_same_value = prev
					}
					has_communications = prev
					NOT = {
						has_country_flag = space_corp_connected_@prev
					}
					# performance intensive?
					any_owned_fleet = {
						can_access_system = event_target:headquarters_planet.solar_system
					}
				}
				set_country_flag = space_corp_connected_@prev
			}
		}
	}
}

# called from space_corps_pulse.11
# spawn a corp
country_event = {
	id = space_corps_pulse.18
	is_triggered_only = yes
	picture = GFX_evt_tradestation_interior
	title = "space_corps_pulse.18.title"
	desc = "space_corps_pulse.18.desc"
	option = {
		name = OK
	}
}

# monthly pulse
# trigger event for corps randomly in the month
event = {
	id = space_corps_pulse.20
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		if = {
			limit = {
				NOT = {
					has_global_flag = space_corps_paused
				}
			}
			every_country = {
				limit = {
					is_country_type = space_corp
				}
				country_event = {
					id = space_corps_pulse.21
					days = 1
					random = 28
				}
				country_event = {
					id = space_corps_pulse.22
					days = 1
				}
			}
		}
	}
}

# build ships if necessary
# checks if enough research to get a tech
# once per month
# triggered by space_corps_pulse.20
country_event = {
	id = space_corps_pulse.21
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		exists = overlord
	}
	immediate = {
		get_headquarters = yes
		# build ships
		if = {
			limit = {
				should_build_science_ship = yes
			}
			create_science_ship_fleet = yes
		}
		if = {
			limit = {
				should_build_builder = yes
			}
			create_builder_fleet = yes
		}
		if = {
			limit = {
				should_start_convoy = yes
			}
			launch_convoy_if_possible = yes
		}
		if = {
			limit = {
				should_reinforce_a_fleet = yes
			}
			random_owned_fleet = {
				limit = {
					# fleet_power > 0
					is_ship_class = shipclass_military
					fleet_power < 1000
				}
				set_fleet_flag = fleet_needs_new_ships
			}
		}
		else_if = {
			limit = {
				should_create_military_fleet = yes
			}
			event_target:headquarters_planet = {
				create_corp_military_fleet = yes
			}
		}
		# check for tech
		corps_load_research_points = yes
		set_tech_costs = yes
		get_random_physics_tech_if_possible = yes
		get_random_society_tech_if_possible = yes
		get_random_engineering_tech_if_possible = yes
	}
}

# compute income and taxes
# once per month
# triggered by space_corps_pulse.20
country_event = {
	id = space_corps_pulse.22
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		exists = overlord
	}
	immediate = {
		compute_and_tax_space_corp_income = yes
	}
}
