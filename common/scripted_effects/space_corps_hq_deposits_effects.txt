# this = corp
# hq set
build_hq_deposit_if_possible = {
	# if a deposit wasn't chosen, choose one
	if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 0
			}
		}
		space_corps_choose_hq_deposits = yes
	}
	# switch on major (1) / minor (2)
	if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 1
			}
		}
		switch = {
			trigger = has_civic
			sc_civic_research_consortium = {
				build_hq_deposit_if_possible_aux = {
					TYPE = d_iisc_research_consortium_regular
				}
			}
			sc_civic_engineering_firm = {
				build_hq_deposit_if_possible_aux = {
					TYPE = d_iisc_engineering_firm_regular
				}
			}
			sc_civic_mining_union = {
				build_hq_deposit_if_possible_aux = {
					TYPE = d_iisc_mining_union_regular
				}
			}
			sc_civic_security_force = {
				build_hq_deposit_if_possible_aux = {
					TYPE = d_iisc_security_force_regular
				}
			}
			sc_civic_logistics_agency = {
				build_hq_deposit_if_possible_aux = {
					TYPE = d_iisc_logistics_agency_regular
				}
			}
			sc_civic_exploration_initiative = {
				build_hq_deposit_if_possible_aux = {
					TYPE = d_iisc_exploration_initiative_regular
				}
			}
			sc_civic_financial_group = {
				build_hq_deposit_if_possible_aux = {
					TYPE = d_iisc_financial_group_regular
				}
			}
		}
	}
}

# this = corp
# TYPE = the name of the deposit
# hq set
build_hq_deposit_if_possible_aux = {
	# if there isn't the last level of the deposit
	if = {
		limit = {
			can_increase_space_corps_hq_deposit = {
				TYPE = $TYPE$
			}
		}
		# then check if we have enough budget
		if = {
			limit = {
				check_variable = {
					which = space_corp_budget_colonization
					value >= @d_iisc_deposits_cost
				}
			}
			subtract_corp_money = {
				TYPE = colonization
				AMOUNT = @d_iisc_deposits_cost
			}
			increase_space_corps_hq_deposit = {
				TYPE = $TYPE$
			}
			set_variable = {
				which = space_corps_hq_deposit_chosen
				value = 0
			}
		}
	}
	# else it means the deposit is full, we need to choose another one (next month)
	else = {
		set_variable = {
			which = space_corps_hq_deposit_chosen
			value = 0
		}
	}
}

# this = corp
space_corps_choose_hq_deposits = {
	if = {
		limit = {
			has_ethic = ethic_gestalt_consciousness
		}
		# TODO add major/minor deposits for gestalt
	}
	else = {
		# TODO a randomlist for major/minor
		switch = {
			trigger = has_civic
			sc_civic_research_consortium = {
				if = {
					limit = {
						NOT = {
							event_target:headquarters_planet = {
								has_deposit = d_iisc_research_consortium_regular_10
							}
						}
					}
					set_variable = {
						which = space_corps_hq_deposit_chosen
						value = 1
					}
				}
			}
			sc_civic_engineering_firm = {
				if = {
					limit = {
						NOT = {
							event_target:headquarters_planet = {
								has_deposit = d_iisc_engineering_firm_regular_10
							}
						}
					}
					set_variable = {
						which = space_corps_hq_deposit_chosen
						value = 1
					}
				}
			}
			sc_civic_mining_union = {
				if = {
					limit = {
						NOT = {
							event_target:headquarters_planet = {
								has_deposit = d_iisc_mining_union_regular_10
							}
						}
					}
					set_variable = {
						which = space_corps_hq_deposit_chosen
						value = 1
					}
				}
			}
			sc_civic_security_force = {
				if = {
					limit = {
						NOT = {
							event_target:headquarters_planet = {
								has_deposit = d_iisc_security_force_regular_10
							}
						}
					}
					set_variable = {
						which = space_corps_hq_deposit_chosen
						value = 1
					}
				}
			}
			sc_civic_logistics_agency = {
				if = {
					limit = {
						NOT = {
							event_target:headquarters_planet = {
								has_deposit = d_iisc_logistics_agency_regular_10
							}
						}
					}
					set_variable = {
						which = space_corps_hq_deposit_chosen
						value = 1
					}
				}
			}
			sc_civic_exploration_initiative = {
				if = {
					limit = {
						NOT = {
							event_target:headquarters_planet = {
								has_deposit = d_iisc_exploration_initiative_regular_10
							}
						}
					}
					set_variable = {
						which = space_corps_hq_deposit_chosen
						value = 1
					}
				}
			}
			sc_civic_financial_group = {
				if = {
					limit = {
						NOT = {
							event_target:headquarters_planet = {
								has_deposit = d_iisc_financial_group_regular_10
							}
						}
					}
					set_variable = {
						which = space_corps_hq_deposit_chosen
						value = 1
					}
				}
			}
		}
	}
}

# this = corp
# TYPE = deposit type
# hq set
increase_space_corps_hq_deposit = {
	event_target:headquarters_planet = {
		if = {
			limit = {
				has_deposit = $TYPE$_9
			}
			remove_deposit = $TYPE$_9
			add_deposit = $TYPE$_10
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_8
			}
			remove_deposit = $TYPE$_8
			add_deposit = $TYPE$_9
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_7
			}
			remove_deposit = $TYPE$_7
			add_deposit = $TYPE$_8
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_6
			}
			remove_deposit = $TYPE$_6
			add_deposit = $TYPE$_7
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_5
			}
			remove_deposit = $TYPE$_5
			add_deposit = $TYPE$_6
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_4
			}
			remove_deposit = $TYPE$_4
			add_deposit = $TYPE$_5
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_3
			}
			remove_deposit = $TYPE$_3
			add_deposit = $TYPE$_4
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_2
			}
			remove_deposit = $TYPE$_2
			add_deposit = $TYPE$_3
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_1
			}
			remove_deposit = $TYPE$_1
			add_deposit = $TYPE$_2
		}
		else_if = {
			limit = {
				NOT = {
					# shouldn't happen
					has_deposit = $TYPE$_10
				}
			}
			add_deposit = $TYPE$_1
		}
		check_planet_employment = yes
	}
	change_variable = {
		which = space_corps_$TYPE$
		value = 1
	}
}

# this = corp
# TYPE = deposit type
# hq set
# TODO when used : add a trigger to check if the corp has the deposit (in case we add several corps on one planet)
decrease_space_corps_hq_deposit = {
	subtract_variable = {
		which = space_corps_$TYPE$
		value = 1
	}
	event_target:headquarters_planet = {
		if = {
			limit = {
				has_deposit = $TYPE$_10
			}
			remove_deposit = $TYPE$_10
			add_deposit = $TYPE$_9
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_9
			}
			remove_deposit = $TYPE$_9
			add_deposit = $TYPE$_8
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_8
			}
			remove_deposit = $TYPE$_8
			add_deposit = $TYPE$_7
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_7
			}
			remove_deposit = $TYPE$_7
			add_deposit = $TYPE$_6
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_6
			}
			remove_deposit = $TYPE$_6
			add_deposit = $TYPE$_5
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_5
			}
			remove_deposit = $TYPE$_5
			add_deposit = $TYPE$_4
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_4
			}
			remove_deposit = $TYPE$_4
			add_deposit = $TYPE$_3
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_3
			}
			remove_deposit = $TYPE$_3
			add_deposit = $TYPE$_2
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_2
			}
			remove_deposit = $TYPE$_2
			add_deposit = $TYPE$_1
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_1
			}
			remove_deposit = $TYPE$_1
		}
	}
}
