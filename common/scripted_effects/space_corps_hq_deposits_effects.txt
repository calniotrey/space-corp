# this = corp
# hq set
build_hq_deposit_if_possible = {
	# if a deposit wasn't chosen, choose one
	if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 0
			}
		}
		space_corps_choose_hq_deposits = yes
	}
	# TODO performance change into binary search?
	# switch on the chosen deposit
	if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 1
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_clerk
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 2
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_energy_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 3
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_minerals_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 4
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_food_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 5
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_researcher_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 6
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_artisan_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 7
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_foundry_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 8
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_bureaucrat_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 9
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_culture_worker_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 10
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_priest_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 11
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_entertainer_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 12
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_duelist_regular
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = space_corps_hq_deposit_chosen
				value = 13
			}
		}
		build_hq_deposit_if_possible_aux = {
			TYPE = d_sc_enforcer_regular_10
		}
	}
}

# this = corp
# TYPE = the name of the deposit
# hq set
build_hq_deposit_if_possible_aux = {
	if = {
		limit = {
			check_variable = {
				which = space_corp_budget_colonization
				value >= space_corps_hq_deposit_chosen_cost
			}
			can_increase_space_corps_hq_deposit = {
				TYPE = $TYPE$
			}
		}
		subtract_corp_money = {
			TYPE = colonization
			AMOUNT = space_corps_hq_deposit_chosen_cost
		}
		increase_space_corps_hq_deposit = {
			TYPE = $TYPE$
		}
		set_variable = {
			which = space_corps_hq_deposit_chosen
			value = 0
		}
	}
}

# this = corp
space_corps_choose_hq_deposits = {
	if = {
		limit = {
			has_ethic = ethic_gestalt_consciousness
		}
		# TODO add menial and complex drones
	}
	else = {
		# TODO add specialists
		random_list = {
			60 = {
				modifier = {
					factor = 0
					event_target:headquarters_planet = {
						has_deposit = d_sc_clerk_10
					}
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 1
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_clerk_cost
				}
			}
			40 = {
				modifier = {
					factor = 0
					event_target:headquarters_planet = {
						has_deposit = d_sc_energy_regular_10
					}
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 2
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_energy_regular_cost
				}
			}
			40 = {
				modifier = {
					factor = 0
					event_target:headquarters_planet = {
						has_deposit = d_sc_minerals_regular_10
					}
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 3
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_minerals_regular_cost
				}
			}
			40 = {
				modifier = {
					factor = 0
					event_target:headquarters_planet = {
						has_deposit = d_sc_food_regular_10
					}
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 4
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_food_regular_cost
				}
			}
			20 = {
				modifier = {
					factor = 0
					event_target:headquarters_planet = {
						has_deposit = d_sc_researcher_regular_10
					}
				}
				modifier = {
					factor = 3
					has_ethic = ethic_materialist
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 5
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_researcher_regular_cost
				}
			}
			20 = {
				modifier = {
					factor = 0
					event_target:headquarters_planet = {
						has_deposit = d_sc_artisan_regular_10
					}
				}
				modifier = {
					factor = 3
					has_ethic = ethic_pacifist
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 6
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_artisan_regular_cost
				}
			}
			20 = {
				modifier = {
					factor = 0
					event_target:headquarters_planet = {
						has_deposit = d_sc_foundry_regular_10
					}
				}
				modifier = {
					factor = 3
					has_ethic = ethic_militarist
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 7
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_foundry_regular_cost
				}
			}
			20 = {
				modifier = {
					factor = 0
					event_target:headquarters_planet = {
						has_deposit = d_sc_bureaucrat_regular_10
					}
				}
				modifier = {
					factor = 3
					has_ethic = ethic_xenophobe
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 8
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_bureaucrat_regular_cost
				}
			}
			20 = {
				modifier = {
					factor = 0
					OR = {
						event_target:headquarters_planet = {
							has_deposit = d_sc_culture_worker_regular_10
						}
						overlord = {
							has_ethic = ethic_spiritualist
						}
					}
				}
				modifier = {
					factor = 3
					has_ethic = ethic_spiritualist
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 9
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_culture_worker_regular_cost
				}
			}
			20 = {
				modifier = {
					factor = 0
					OR = {
						event_target:headquarters_planet = {
							has_deposit = d_sc_priest_regular_10
						}
						NOT = {
							overlord = {
								has_ethic = ethic_spiritualist
							}
						}
					}
				}
				modifier = {
					factor = 3
					has_ethic = ethic_spiritualist
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 10
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_priest_regular_cost
				}
			}
			20 = {
				modifier = {
					factor = 0
					OR = {
						event_target:headquarters_planet = {
							has_deposit = d_sc_entertainer_regular_10
						}
						overlord = {
							has_valid_civic = civic_warrior_culture
						}
					}
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 11
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_entertainer_regular_cost
				}
			}
			20 = {
				modifier = {
					factor = 0
					OR = {
						event_target:headquarters_planet = {
							has_deposit = d_sc_duelist_regular_10
						}
						NOT = {
							overlord = {
								has_valid_civic = civic_warrior_culture
							}
						}
					}
				}
				modifier = {
					factor = 1.5
					overlord = {
						has_valid_civic = civic_warrior_culture
					}
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 12
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_duelist_regular_cost
				}
			}
			20 = {
				modifier = {
					factor = 0
					OR = {
						event_target:headquarters_planet = {
							has_deposit = d_sc_enforcer_regular_10
						}
					}
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen
					value = 13
				}
				set_variable = {
					which = space_corps_hq_deposit_chosen_cost
					value = @d_sc_enforcer_regular_cost
				}
			}
		}
	}
}

# this = corp
# TYPE = deposit type
# hq set
increase_space_corps_hq_deposit = {
	event_target:headquarters_planet = {
		if = {
			limit = {
				has_deposit = $TYPE$_9
			}
			remove_deposit = $TYPE$_9
			add_deposit = $TYPE$_10
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_8
			}
			remove_deposit = $TYPE$_8
			add_deposit = $TYPE$_9
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_7
			}
			remove_deposit = $TYPE$_7
			add_deposit = $TYPE$_8
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_6
			}
			remove_deposit = $TYPE$_6
			add_deposit = $TYPE$_7
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_5
			}
			remove_deposit = $TYPE$_5
			add_deposit = $TYPE$_6
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_4
			}
			remove_deposit = $TYPE$_4
			add_deposit = $TYPE$_5
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_3
			}
			remove_deposit = $TYPE$_3
			add_deposit = $TYPE$_4
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_2
			}
			remove_deposit = $TYPE$_2
			add_deposit = $TYPE$_3
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_1
			}
			remove_deposit = $TYPE$_1
			add_deposit = $TYPE$_2
		}
		else_if = {
			limit = {
				NOT = {
					# shouldn't happen
					has_deposit = $TYPE$_10
				}
			}
			add_deposit = $TYPE$_1
		}
	}
	change_variable = {
		which = space_corps_$TYPE$
		value = 1
	}
}

# this = corp
# TYPE = deposit type
# hq set
# TODO when used : add a trigger to check if the corp has the deposit (in case we add several corps on one planet)
decrease_space_corps_hq_deposit = {
	subtract_variable = {
		which = space_corps_$TYPE$
		value = 1
	}
	event_target:headquarters_planet = {
		if = {
			limit = {
				has_deposit = $TYPE$_10
			}
			remove_deposit = $TYPE$_10
			add_deposit = $TYPE$_9
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_9
			}
			remove_deposit = $TYPE$_9
			add_deposit = $TYPE$_8
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_8
			}
			remove_deposit = $TYPE$_8
			add_deposit = $TYPE$_7
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_7
			}
			remove_deposit = $TYPE$_7
			add_deposit = $TYPE$_6
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_6
			}
			remove_deposit = $TYPE$_6
			add_deposit = $TYPE$_5
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_5
			}
			remove_deposit = $TYPE$_5
			add_deposit = $TYPE$_4
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_4
			}
			remove_deposit = $TYPE$_4
			add_deposit = $TYPE$_3
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_3
			}
			remove_deposit = $TYPE$_3
			add_deposit = $TYPE$_2
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_2
			}
			remove_deposit = $TYPE$_2
			add_deposit = $TYPE$_1
		}
		else_if = {
			limit = {
				has_deposit = $TYPE$_1
			}
			remove_deposit = $TYPE$_1
		}
	}
}
